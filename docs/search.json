[{"path":"/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2023 allofus authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"/articles/data-browser.html","id":"using-the-allofus-data-browser-and-r-together","dir":"Articles","previous_headings":"","what":"Using the AllofUs data browser and R together","title":"Using the Data Browser and AllofUs Database","text":"vignette go use AllofUs Research Data Browser identify questions interest, pull data OMOP-CDM structured database. Data Browser useful took quickly finding data (survey questions, conditions electronic health record, fitbit measurements etc.). can found : https://databrowser.researchallofus.org/ available publicly. However, ’s always clear exactly query OMOP-CDM database find data can preview Data Browser. Later Edit: Nearly key information need find survey data can found : https://support.researchallofus.org/hc/en-us/articles/6085114880148.","code":""},{"path":[]},{"path":"/articles/data-browser.html","id":"the-basics","dir":"Articles","previous_headings":"Using the AllofUs data browser and R together > Survey Data","what":"The Basics","title":"Using the Data Browser and AllofUs Database","text":"Finding question “country born?” participants answers  can see image “Concept Code” Birthplace USA 1586136. Non-Standard AllofUs specific code used identify Birthplace: USA. need find code question. easy way search code Athena (https://athena.ohdsi.org/search-terms/start).  Clicking Birthplace:USA reveals Observation Domain, question Answer, PPI Vocabulary (vocabulary AllofUs specific, non-standard codes). also see PPI Parent Code 1586135 “Basics: Birthplace”. non-standard code question. can also see non-standard Standard map (OMOP) Birthlace code 3005917. Standard code “Birthplace”.  successful finding AllofUs Data Data Browswer, really important understand difference non-standard standard codes. non-standard codes specific AllofUs database. Standard codes codes found OMOP database. non-standard codes found **{table}_source_concept_id** columns. standard codes found **{table}_concept_id** columns Lets look survey question example. can find question, non-standard code 1586135 observation table. AllofUs specific code Basics: Birthplace question observation_source_concept_id column. ’s glimpse distinct responses code (note ’ve omitted important columns like person_id observation_date shown aggregate row comply AllofUs data sharing restrictions). columns match values saw Athena. can see standard concept ID Birthplace question observation_concept_id column. observation_source_value observation_source_concept_id columns hold related non-standard codes question. Finally, see survey responses : non-standard concept code saw data browser value_source_concept_id column text version code value_source_value.","code":"# start by connecting to the database library(allofus) library(dplyr) con <- aou_connect() tbl(con, \"observation\") %>%     filter(observation_source_concept_id == 1586135) %>%     head() %>%      distinct(observation_concept_id, observation_source_value,            observation_source_concept_id, value_source_concept_id, value_source_value) %>%     collect()"},{"path":"/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Rob Cavanaugh. Author, maintainer. Louisa Smith. Author.","code":""},{"path":"/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Cavanaugh R, Smith L (2023). allofus: R package streamline use AllofUs Resarcher Workbench. https://roux-ohdsi.github.io/allofus/, https://github.com/roux-ohdsi/allofus.","code":"@Manual{,   title = {allofus: R package to streamline use of the AllofUs Resarcher Workbench},   author = {Rob Cavanaugh and Louisa Smith},   year = {2023},   note = {https://roux-ohdsi.github.io/allofus/, https://github.com/roux-ohdsi/allofus}, }"},{"path":[]},{"path":"/index.html","id":"installation","dir":"","previous_headings":"R package to streamline use of the AllofUs Research Workbench","what":"Installation","title":"R package to streamline use of the AllofUs Resarcher Workbench ","text":"","code":"install.packages(\"remotes\") remotes::install_github(\"roux-ohdsi/allofus\")"},{"path":"/index.html","id":"use","dir":"","previous_headings":"R package to streamline use of the AllofUs Research Workbench","what":"Use","title":"R package to streamline use of the AllofUs Resarcher Workbench ","text":"Use aou_connect() establish database connection. also save bucket name variable called bucket (can customized using bucket_name argument) , can use aou_ls_bucket() list files bucket Files workspace accessible , collaborators (see details storage ). need move file workspace bucket personal workspace, use aou_bucket_to_workspace() move files bucket workspace want save something workspace bucket collaborators can use (can shut workspace save $$$), can use aou_workspace_to_bucket() move files workspace bucket permanent storage. also function can use load packages, install yet (longer) installed environment.","code":"library(allofus) con <- aou_connect() aou_ls_bucket() aou_bucket_to_workspace(\"file1.csv\") data <- read.csv(\"file1.csv\") write.csv(data, \"file1.csv\") aou_bucket_to_workspace(\"file1.csv\") bookstore(c(\"CohortGenerator\", \"tidyr\")"},{"path":"/index.html","id":"bugs","dir":"","previous_headings":"R package to streamline use of the AllofUs Research Workbench","what":"Bugs","title":"R package to streamline use of the AllofUs Resarcher Workbench ","text":"Please leave us comments, requests, report bugs using “Issues” tab github located : https://github.com/roux-ohdsi/allofus/issues.","code":""},{"path":"/index.html","id":"tips-on-using-the-allofus-workbench","dir":"","previous_headings":"R package to streamline use of the AllofUs Research Workbench","what":"Tips on using the AllofUs Workbench","title":"R package to streamline use of the AllofUs Resarcher Workbench ","text":"Working data AllofUs similar working OMOP CDM instances important differences: AllofUs includes data typical OMOP CDM tables, well additional AllofUs specific tables. data dictionary registered tier can found controlled tier . part, additional tables hold data collected AllofUs typical EHR claims data (e.g., fitbit data). can write temporary tables database AllofUs dplyr/dbplyr won’t write temporary tables bigquery db. Additionally, users permanent write access schema database. Unfortunately, means many OHDSI R packages work allofus workbench. also means can’t use SQL/JSON code generated ATLAS pull cohort (code also uses user schema/write schema). workbench uses jupyter notebooks (though RStudio coming). ’s important understand data stored AllofUs. user persistent disk (“workspace”) specific user. given Project Workspace, shared “data bucket” holds data anyone access Project workspace can access. Unless ’re sure one else need see data scripts use data, currently recommend using bucket storage needs permanent. However, unlike persistent disk, can’t just run read.csv(\"data.csv\") bucket. move data bucket persistent disk/workspace (current environment) first.","code":""},{"path":"/index.html","id":"example","dir":"","previous_headings":"R package to streamline use of the AllofUs Research Workbench","what":"Example","title":"R package to streamline use of the AllofUs Resarcher Workbench ","text":"following code start query first survey date AllofUs survey “Basics” (sometimes, rarely, participants completed survey multiple dates). ds_survey table conveniently organized, include “skip” response surveys, don’t recommend using unless ’re sure potential responses recorded table. ’s safest use observation table. can see detailed description survey ETL : https://support.researchallofus.org/hc/en-us/articles/6085114880148. code start us specific person table join survey dates table incorporate information demographics. leave query, pull data local session:","code":"library(tidyverse)  survey_dates = tbl(con, \"ds_survey\") %>%   filter(survey == \"The Basics\") %>%   group_by(person_id) %>%   filter(survey_datetime == min(survey_datetime)) %>%   distinct(person_id, survey_datetime) demo <- tbl(con, \"cb_search_person\") %>%   filter(age_at_consent >= 40 & age_at_consent <= 120,          has_ehr_data == 1) %>%   distinct(person_id, sex_at_birth, dob)  %>%   inner_join(survey_dates, by = \"person_id\") %>%   select(person_id, sex_at_birth, dob, survey_datetime) demo_collected <- demo %>% collect()"},{"path":"/reference/aou_bucket_to_workspace.html","id":null,"dir":"Reference","previous_headings":"","what":"Move files from a bucket to your workspace — aou_bucket_to_workspace","title":"Move files from a bucket to your workspace — aou_bucket_to_workspace","text":"function retrieves file bucket moves workspace can read R, e.g., using function like write.csv(). See https://cloud.google.com/storage/docs/gsutil/commands/cp details underlying function.","code":""},{"path":"/reference/aou_bucket_to_workspace.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Move files from a bucket to your workspace — aou_bucket_to_workspace","text":"","code":"aou_bucket_to_workspace(   file,   dir = \"\",   bucket = getOption(\"aou.default.bucket\") )"},{"path":"/reference/aou_bucket_to_workspace.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Move files from a bucket to your workspace — aou_bucket_to_workspace","text":"file name file bucket, vector multiple files, directory, file pattern (e.g. \".csv\"). dir Optional directory workspace save files . bucket Bucket retrieve file . Defaults `getOption(\"aou.default.bucket\")`, `Sys.getenv('WORKSPACE_BUCKET')` unless specified otherwise.","code":""},{"path":"/reference/aou_bucket_to_workspace.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Move files from a bucket to your workspace — aou_bucket_to_workspace","text":"Nothing","code":""},{"path":"/reference/aou_bucket_to_workspace.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Move files from a bucket to your workspace — aou_bucket_to_workspace","text":"","code":"if (FALSE) { aou_bucket_to_workspace(\"data1.csv\") read.csv(\"data1.csv\") # a file to a specific directory in the workspace aou_bucket_to_workspace(\"data2.csv\", dir = \"data\") read.csv(\"data/data2.csv\") # all of the files in this directory aou_bucket_to_workspace(\"data/\") read.csv(\"data/data3.csv\") }"},{"path":"/reference/aou_codebook.html","id":null,"dir":"Reference","previous_headings":"","what":"World Health Organization TB data — aou_codebook","title":"World Health Organization TB data — aou_codebook","text":"subset data World Health Organization Global Tuberculosis Report ...","code":""},{"path":"/reference/aou_codebook.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"World Health Organization TB data — aou_codebook","text":"","code":"aou_codebook"},{"path":"/reference/aou_codebook.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"World Health Organization TB data — aou_codebook","text":"## `aou_codebook` data frame 1919 rows 11 columns: concept_code chr; Concept code AOU codebook concept_id int; mapped concept_id PPI vocabulary concept_name chr; Formatted text name concept concept_class_id chr; type survey item - question answer form_name int; name survey field_type chr; type question (radio, text, checkbox etc.) field_label chr; actual text question answer choices int; choices question radio checkbox standard_concept chr; Whether concept_id standard omop concept valid_start_Date chr; start date concept valid_end_Date int; end date concept","code":""},{"path":"/reference/aou_codebook.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"World Health Organization TB data — aou_codebook","text":"<https://docs.google.com/spreadsheets/d/1Ey8MScRYZ9QyS4izVYScISLMb62QEhSM-ErbG27dNtw/edit#gid=1832128489>","code":""},{"path":"/reference/aou_connect.html","id":null,"dir":"Reference","previous_headings":"","what":"Create a connection to the database in All of Us — aou_connect","title":"Create a connection to the database in All of Us — aou_connect","text":"Use function create `BigQueryConnection` object. can reference object connect Us database run SQL code using, e.g., `dbplyr` `DBI`. message printed connection status (successful ).","code":""},{"path":"/reference/aou_connect.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create a connection to the database in All of Us — aou_connect","text":"","code":"aou_connect(CDR = getOption(\"aou.default.cdr\"))"},{"path":"/reference/aou_connect.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create a connection to the database in All of Us — aou_connect","text":"CDR name \"curated data repository\" used references form \"CDR\" \"cdr\" query. Defaults getOption(\"aou.default.cdr\"), Sys.getenv('WORKSPACE_CDR') specified otherwise (\"mainline\" CDR). controlled tier, specify \"base\" CDR `CDR = paste0(Sys.getenv('WORKSPACE_CDR'), \"_base\")`.","code":""},{"path":"/reference/aou_connect.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create a connection to the database in All of Us — aou_connect","text":"`BigQueryConnection` object. object also saved getOption(\"aou.default.con\").","code":""},{"path":"/reference/aou_connect.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Create a connection to the database in All of Us — aou_connect","text":"","code":"if (FALSE) { con <- aou_connect() # reference the observation table in the database dplyr::tbl(con, \"observation\") # print a list of the tables in the database DBI::dbListTables(con) }"},{"path":"/reference/aou_join.html","id":null,"dir":"Reference","previous_headings":"","what":"Join current query to another table — aou_join","title":"Join current query to another table — aou_join","text":"Simple wrapper join functions join existing query another table Us database.","code":""},{"path":"/reference/aou_join.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Join current query to another table — aou_join","text":"","code":"aou_join(   data,   table,   type,   by,   suffix = c(\"_x\", \"_y\"),   con = getOption(\"aou.default.con\"),   x_as = NULL,   y_as = NULL,   ... )"},{"path":"/reference/aou_join.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Join current query to another table — aou_join","text":"data SQL query dbplyr/dplyr. table omop table (table schema) wish join type type join. use types available dplyr: left, right, inner, anti, full etc. con defaults connection set options() x_as optional; string name left table y_as optional; string name right table ... arguments passed join function. e.g., = \"person_id\"","code":""},{"path":"/reference/aou_join.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Join current query to another table — aou_join","text":"Continued dbplyr query","code":""},{"path":"/reference/aou_join.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Join current query to another table — aou_join","text":"good reasons use aou_join() possible x_join functions dplyr. First, reduces code necessary join existing table another table. Second, includes checks/workarounds two sources common errors using dbplyr: automatically appends x_as y_as arguments join call provided changes default suffix .x/.y _x/_y cases shared column names specified argument result SQL error.","code":""},{"path":"/reference/aou_join.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Join current query to another table — aou_join","text":"","code":"allofus::aou_connect() #> Error: Unable to connect #> <BigQueryConnection> #>   Dataset: NA.NA #>   Billing:  options(aou.default.con = con) #> Error in options(aou.default.con = con): object 'con' not found obs_tbl |>   omop_join(\"person\", type = \"left\", by = \"person_id\") #> Error in omop_join(obs_tbl, \"person\", type = \"left\", by = \"person_id\"): could not find function \"omop_join\""},{"path":"/reference/aou_ls_bucket.html","id":null,"dir":"Reference","previous_headings":"","what":"List the current files in your bucket — aou_ls_bucket","title":"List the current files in your bucket — aou_ls_bucket","text":"files stored bucket easily visible notebook. List files bucket files matching certain pattern.","code":""},{"path":"/reference/aou_ls_bucket.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"List the current files in your bucket — aou_ls_bucket","text":"","code":"aou_ls_bucket(   pattern = \"\",   silent = FALSE,   recursive = TRUE,   bucket = Sys.getenv(\"WORKSPACE_BUCKET\"),   gsutil_args = \"\" )"},{"path":"/reference/aou_ls_bucket.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"List the current files in your bucket — aou_ls_bucket","text":"pattern Regular expression, \"*.csv\" single file name e.g., \"mydata.csv\". Default find files apart notebooks (.ipynb files). silent Logical; whether print names files found. bucket Bucket retrieve file . Defaults `getOption(\"aou.default.bucket\")`, `Sys.getenv('WORKSPACE_BUCKET')` unless specified otherwise. gsutil_args string containing arguments passed `gsutil ls`. See https://cloud.google.com/storage/docs/gsutil/commands/ls details.","code":""},{"path":"/reference/aou_ls_bucket.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"List the current files in your bucket — aou_ls_bucket","text":"vector file names","code":""},{"path":"/reference/aou_ls_bucket.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"List the current files in your bucket — aou_ls_bucket","text":"","code":"if (FALSE) { # list all files, including in subdirectories aou_ls_bucket() # list all csv files aou_ls_bucket(\"*.csv\") # list all csv files in the data directory aou_ls_bucket(\"data/*.csv\") }"},{"path":"/reference/aou_ls_workspace.html","id":null,"dir":"Reference","previous_headings":"","what":"List the current files in your workspace — aou_ls_workspace","title":"List the current files in your workspace — aou_ls_workspace","text":"files stored workspace easily visible notebook. List files workspace (apart notebooks) files matching certain pattern.","code":""},{"path":"/reference/aou_ls_workspace.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"List the current files in your workspace — aou_ls_workspace","text":"","code":"aou_ls_workspace(pattern = \"\", silent = FALSE, ...)"},{"path":"/reference/aou_ls_workspace.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"List the current files in your workspace — aou_ls_workspace","text":"pattern Regular expression, \"*.csv\" single file name e.g., \"mydata.csv\". Default find files apart notebooks (.ipynb files). silent Logical; whether print names files found. ... arguments passed `list.files()`","code":""},{"path":"/reference/aou_ls_workspace.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"List the current files in your workspace — aou_ls_workspace","text":"vector file names","code":""},{"path":"/reference/aou_ls_workspace.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"List the current files in your workspace — aou_ls_workspace","text":"","code":"aou_ls_workspace() #> Rplot001.png  #> aou_bucket_to_workspace.html  #> aou_codebook.html  #> aou_connect.html  #> aou_join.html  #> aou_ls_bucket.html  #> aou_ls_workspace.html  #> aou_pull_concepts.html  #> aou_pull_survey_concepts.html  #> aou_sql.html  #> aou_workspace_to_bucket.html  #> bookstore.html  #> figures  #> index.html  #> omop_join.html  aou_ls_workspace(\"*.csv\") #> No files found with that pattern. aou_ls_workspace(path = \"data\") #> No files found with that pattern."},{"path":"/reference/aou_pull_concepts.html","id":null,"dir":"Reference","previous_headings":"","what":"Get occurrences of a concepts from AoU for a given cohort — aou_pull_concepts","title":"Get occurrences of a concepts from AoU for a given cohort — aou_pull_concepts","text":"Get occurrences concepts AoU given cohort","code":""},{"path":"/reference/aou_pull_concepts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get occurrences of a concepts from AoU for a given cohort — aou_pull_concepts","text":"","code":"aou_pull_concepts(   cohort,   concepts,   start_date,   end_date,   concept_set_name = \"concepts\",   domains = c(\"condition\", \"measurement\", \"observation\", \"procedure\", \"drug\", \"device\"),   min_n = NULL,   n = FALSE,   keep_all = FALSE,   con = getOption(\"aou.default.con\"),   collect = TRUE,   ... )"},{"path":"/reference/aou_pull_concepts.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get occurrences of a concepts from AoU for a given cohort — aou_pull_concepts","text":"cohort tbl; reference table column called \"person_id\", columns start_date end_date concepts num; vector concept ids start_date name start_date column cohort table (unquoted) end_date name end_date column cohort table (unquoted) concept_set_name chr; Name describe concept set, used create indicator variable min_n dbl; minimum number occurrences per person consider indicator true n dbl; count number occurrences per person (include zeros) keep_all lgl; keep columns information concept (e.g., concept name, id, etc.) con connection object AoU collect lgl; whether collect database","code":""},{"path":"/reference/aou_pull_concepts.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get occurrences of a concepts from AoU for a given cohort — aou_pull_concepts","text":"dataframe collect = TRUE; remote tbl ","code":""},{"path":"/reference/aou_pull_concepts.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get occurrences of a concepts from AoU for a given cohort — aou_pull_concepts","text":"","code":"if (FALSE) { # simple example tobacco <- pull_concepts(cohort, concepts = 1157, start_date = covariate_start_date,  end_date = cohort_start_date, name = \"tobacco\")  # starting with person table people <- tbl(con, \"cb_search_person\") %>% mutate(start_date = as.Date(\"1970-01-01\"),        end_date = as.Date(\"2023-05-24\"))  dat <- aou_pull_concepts(cohort = people,                          concepts = c(725115, 1612146, 1613031),                          start_date = start_date,                          end_date = end_date, concept_set_name = \"CGM\",                          domains = c(\"condition\", \"measurement\", \"observation\", \"procedure\", \"drug\", \"device\"),                          keep_all = TRUE)  }"},{"path":"/reference/aou_pull_survey_concepts.html","id":null,"dir":"Reference","previous_headings":"","what":"Get survey questions from AoU for a given cohort — aou_pull_survey_concepts","title":"Get survey questions from AoU for a given cohort — aou_pull_survey_concepts","text":"Get survey questions AoU given cohort","code":""},{"path":"/reference/aou_pull_survey_concepts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get survey questions from AoU for a given cohort — aou_pull_survey_concepts","text":"","code":"aou_pull_survey_concepts(   cohort,   concepts,   collect = TRUE,   reshape = FALSE,   ... )"},{"path":"/reference/aou_pull_survey_concepts.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get survey questions from AoU for a given cohort — aou_pull_survey_concepts","text":"cohort tbl; reference table column called \"person_id\" concepts num; vector concept ids questions survey table collect lgl; whether collect database reshape lgl; whether turn long data wide data clean variable names","code":""},{"path":"/reference/aou_pull_survey_concepts.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get survey questions from AoU for a given cohort — aou_pull_survey_concepts","text":"reshape = FALSE, dataframe remote tbl columns person_id, date (survey_datetime),  concept_id (question_concept_id), question, answer. reshape = TRUE, dataframe  questions columns. multiple answers per person (\"checkbox\" questions) list-columns.","code":""},{"path":[]},{"path":"/reference/aou_sql.html","id":null,"dir":"Reference","previous_headings":"","what":"Execute a SQL query — aou_sql","title":"Execute a SQL query — aou_sql","text":"Execute SQL query","code":""},{"path":"/reference/aou_sql.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Execute a SQL query — aou_sql","text":"","code":"aou_sql(query, CDR = getOption(\"aou.default.cdr\"), download = TRUE, ...)"},{"path":"/reference/aou_sql.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Execute a SQL query — aou_sql","text":"query SQL query (BigQuery dialect) executed. Interpreted `glue::glue()`, expressions enclosed braces evaluated. References `cdr` `CDR` evaluated automatically. CDR name \"curated data repository\" used references form \"CDR\" \"cdr\" query. Defaults getOption(\"aou.default.cdr\"), Sys.getenv('WORKSPACE_CDR') specified otherwise (\"mainline\" CDR). controlled tier, specify \"base\" CDR `CDR = paste0(Sys.getenv('WORKSPACE_CDR'), \"_base\")`. download want retrieve result SQL query local environment? Defaults `TRUE`. ... arguments passed `bigrquery::bq_table_download()`","code":""},{"path":"/reference/aou_sql.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Execute a SQL query — aou_sql","text":"dataframe (`download = TRUE`); otherwise, `bq_table` object","code":""},{"path":"/reference/aou_sql.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Execute a SQL query — aou_sql","text":"","code":"# Examples based on AoU snippets if (FALSE) { aou_sql('   -- Compute the count of unique participants in our All of Us cohort.   SELECT   COUNT(DISTINCT person_id) AS total_number_of_participants   FROM   `{CDR}.person` ')  MEASUREMENT_OF_INTEREST <- \"hemoglobin\" aou_sql(' -- Compute summary information for our measurements of interest for our cohort. -- -- PARAMETERS: --   MEASUREMENT_OF_INTEREST: a case-insensitive string, such as \"hemoglobin\", to be compared --                            to all measurement concept names to identify those of interest  WITH   --   -- Use a case insensitive string to search the measurement concept names of those   -- measurements we do have in the measurements table.   --   labs_of_interest AS (   SELECT     measurement_concept_id,     measurement_concept.concept_name AS measurement_name,     unit_concept_id,     unit_concept.concept_name AS unit_name   FROM     `{CDR}.measurement`   LEFT JOIN `{CDR}.concept` AS measurement_concept   ON measurement_concept.concept_id = measurement_concept_id   LEFT JOIN `{CDR}.concept` AS unit_concept   ON unit_concept.concept_id = unit_concept_id   WHERE     REGEXP_CONTAINS(measurement_concept.concept_name, r\"(?i){MEASUREMENT_OF_INTEREST}\")   GROUP BY     measurement_concept_id,     unit_concept_id,     measurement_concept.concept_name,     unit_concept.concept_name )   --   -- Summarize the information about each measurement concept of interest that our   -- prior query identified.   -- SELECT   measurement_name AS measurement,   IFNULL(unit_name, \"NA\") AS unit,   COUNT(1) AS N,   COUNTIF(value_as_number IS NULL     AND (value_as_concept_id IS NULL       OR value_as_concept_id = 0)) AS missing,   MIN(value_as_number) AS min,   MAX(value_as_number) AS max,   AVG(value_as_number) AS avg,   STDDEV(value_as_number) AS stddev,   APPROX_QUANTILES(value_as_number, 4) AS quantiles,   COUNTIF(value_as_number IS NOT NULL) AS num_numeric_values,   COUNTIF(value_as_concept_id IS NOT NULL       AND value_as_concept_id != 0) AS num_concept_values,   COUNTIF(operator_concept_id IS NOT NULL) AS num_operators,   IF(src_id = \"PPI/PM\", \"PPI\", \"EHR\") AS measurement_source,   measurement_concept_id,   unit_concept_id FROM   `{CDR}.measurement` INNER JOIN  labs_of_interest USING(measurement_concept_id, unit_concept_id) LEFT JOIN   `{CDR}.measurement_ext` USING(measurement_id) GROUP BY   measurement_concept_id,   measurement_name,   measurement_source,   unit_concept_id,   unit_name ORDER BY   N DESC ') }"},{"path":"/reference/aou_workspace_to_bucket.html","id":null,"dir":"Reference","previous_headings":"","what":"Save a file from your workspace to your bucket. — aou_workspace_to_bucket","title":"Save a file from your workspace to your bucket. — aou_workspace_to_bucket","text":"function moves file saved workspace bucket, can retrieved even environment deleted. use, first save desired object file workspace (e.g., write.csv(object, \"filename.csv\")) run function (e.g., aou_workspace_to_bucket(files = \"filename.csv\")). See https://cloud.google.com/storage/docs/gsutil/commands/cp details underlying function.","code":""},{"path":"/reference/aou_workspace_to_bucket.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Save a file from your workspace to your bucket. — aou_workspace_to_bucket","text":"","code":"aou_workspace_to_bucket(   file,   dir = \"\",   recursive = TRUE,   bucket = getOption(\"aou.default.bucket\") )"},{"path":"/reference/aou_workspace_to_bucket.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Save a file from your workspace to your bucket. — aou_workspace_to_bucket","text":"file name file bucket, vector multiple files, directory, file pattern (e.g. \".csv\"). See Details. dir Optional directory bucket save files . recursive description bucket Bucket save files . Defaults `getOption(\"aou.default.bucket\")`, `Sys.getenv('WORKSPACE_BUCKET')` unless specified otherwise.","code":""},{"path":"/reference/aou_workspace_to_bucket.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Save a file from your workspace to your bucket. — aou_workspace_to_bucket","text":"","code":"if (FALSE) { aou_workspace_to_bucket(\"data1.csv\") # a file to a specific directory in the bucket aou_workspace_to_bucket(\"data2.csv\", dir = \"data\") # all of the files in this directory aou_workspace_to_bucket(\"data/\") # multiple specific files aou_workspace_to_bucket(c(\"data1.csv\", \"data2.csv\")) }"},{"path":"/reference/bookstore.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to Install and Load R Packages — bookstore","title":"Function to Install and Load R Packages — bookstore","text":"Function Install Load R Packages","code":""},{"path":"/reference/bookstore.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to Install and Load R Packages — bookstore","text":"","code":"bookstore(package_names, quietly = TRUE)"},{"path":"/reference/bookstore.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to Install and Load R Packages — bookstore","text":"package_names character vector package names CRAN github description bookstore() function check see packages provided already installed local machine. installed, look package CRAN install found. find package CRAN, 'll ask owner/repository_name github install package github. input provided without quotes. example, respond roux-ohdsi/ohdsilab \"roux-ohdsi/ohdsilab\".","code":""},{"path":"/reference/bookstore.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Function to Install and Load R Packages — bookstore","text":"","code":"if (FALSE) { bookstore(c(\"aouFI\", \"CohortGenerator\", \"tidyr\")) }"},{"path":"/reference/omop_join.html","id":null,"dir":"Reference","previous_headings":"","what":"Join current query to another omop table — omop_join","title":"Join current query to another omop table — omop_join","text":"Simple wrapper join functions join existing query another table omop cdm (source).","code":""},{"path":"/reference/omop_join.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Join current query to another omop table — omop_join","text":"","code":"omop_join(   data,   table,   type,   by,   suffix = c(\"_x\", \"_y\"),   con = getOption(\"aou.default.con\"),   x_as = NULL,   y_as = NULL,   ... )"},{"path":"/reference/omop_join.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Join current query to another omop table — omop_join","text":"data sql query dbplyr/dplyr. table omop table (table schema) wish join type type join. use types available dplyr: left, right, inner, anti, full etc. con defaults connection set options() x_as optional; string name left table y_as optional; string name right table ... arguments passed join function. e.g., = \"person_id\"","code":""},{"path":"/reference/omop_join.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Join current query to another omop table — omop_join","text":"Continued dplyr query","code":""},{"path":"/reference/omop_join.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Join current query to another omop table — omop_join","text":"Include following line top script setting connection con refers connection object R. options(aou.default.con = con) good reasons use omop_join() possible x_join functions dplyr. First, reduces code necessary join existing table another table. Second, includes checks/workarounds two sources common errors using dplyr DatabaseConnector: automatically appends x_as y_as arguments join call provided changes default suffix .x/.y _x/_y cases shared column names specified argument result sql error.","code":""},{"path":"/reference/omop_join.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Join current query to another omop table — omop_join","text":"","code":"allofus::aou_connect() #> Error: Unable to connect #> <BigQueryConnection> #>   Dataset: NA.NA #>   Billing:  options(aou.default.con = con) #> Error in options(aou.default.con = con): object 'con' not found obs_tbl |>   omop_join(\"person\", type = \"left\", by = \"person_id\") #> Error in tbl(con, table): could not find function \"tbl\""}]
