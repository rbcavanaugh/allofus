[{"path":"/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2023 allofus authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"/articles/data-browser.html","id":"using-the-allofus-data-browser-and-r-together","dir":"Articles","previous_headings":"","what":"Using the AllofUs data browser and R together","title":"Using the Data Browser and AllofUs Database","text":"vignette go use AllofUs Research Data Browser identify questions interest, pull data OMOP-CDM structured database. Data Browser useful took quickly finding data (survey questions, conditions electronic health record, fitbit measurements etc.). can found : https://databrowser.researchallofus.org/ available publicly. However, ’s always clear exactly query OMOP-CDM database find data can preview Data Browser. Later Edit: Nearly key information need find survey data can found : https://support.researchallofus.org/hc/en-us/articles/6085114880148.","code":""},{"path":[]},{"path":"/articles/data-browser.html","id":"the-basics","dir":"Articles","previous_headings":"Using the AllofUs data browser and R together > Survey Data","what":"The Basics","title":"Using the Data Browser and AllofUs Database","text":"Finding question “country born?” participants answers  can see image “Concept Code” Birthplace USA 1586136. Non-Standard AllofUs specific code used identify Birthplace: USA. need find code question. easy way search code Athena (https://athena.ohdsi.org/search-terms/start).  Clicking Birthplace:USA reveals Observation Domain, question Answer, PPI Vocabulary (vocabulary AllofUs specific, non-standard codes). also see PPI Parent Code 1586135 “Basics: Birthplace”. non-standard code question. can also see non-standard Standard map (OMOP) Birthlace code 3005917. Standard code “Birthplace”.  successful finding AllofUs Data Data Browswer, really important understand difference non-standard standard codes. non-standard codes specific AllofUs database. Standard codes codes found OMOP database. non-standard codes found **{table}_source_concept_id** columns. standard codes found **{table}_concept_id** columns Lets look survey question example. can find question, non-standard code 1586135 observation table. AllofUs specific code Basics: Birthplace question observation_source_concept_id column. ’s glimpse distinct responses code (note ’ve omitted important columns like person_id observation_date shown aggregate row comply AllofUs data sharing restrictions). columns match values saw Athena. can see standard concept ID Birthplace question observation_concept_id column. observation_source_value observation_source_concept_id columns hold related non-standard codes question. Finally, see survey responses : non-standard concept code saw data browser value_source_concept_id column text version code value_source_value.","code":"# start by connecting to the database library(allofus) library(dplyr) con <- aou_connect() tbl(con, \"observation\") %>%     filter(observation_source_concept_id == 1586135) %>%     head() %>%      distinct(observation_concept_id, observation_source_value,            observation_source_concept_id, value_source_concept_id, value_source_value) %>%     collect()"},{"path":"/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Rob Cavanaugh. Author, maintainer. Louisa Smith. Author.","code":""},{"path":"/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Cavanaugh R, Smith L (2023). allofus: R package streamline use AllofUs Resarcher Workbench. https://roux-ohdsi.github.io/allofus/, https://github.com/roux-ohdsi/allofus.","code":"@Manual{,   title = {allofus: R package to streamline use of the AllofUs Resarcher Workbench},   author = {Rob Cavanaugh and Louisa Smith},   year = {2023},   note = {https://roux-ohdsi.github.io/allofus/, https://github.com/roux-ohdsi/allofus}, }"},{"path":[]},{"path":"/index.html","id":"installation","dir":"","previous_headings":"R package to streamline use of the AllofUs Research Workbench","what":"Installation","title":"R package to streamline use of the AllofUs Resarcher Workbench ","text":"","code":"install.packages(\"remotes\") remotes::install_github(\"roux-ohdsi/allofus\")"},{"path":"/index.html","id":"use","dir":"","previous_headings":"R package to streamline use of the AllofUs Research Workbench","what":"Use","title":"R package to streamline use of the AllofUs Resarcher Workbench ","text":"Use aou_connect() establish database connection. also save bucket name variable called bucket (can customized using bucket_name argument) , can use aou_ls_bucket() list files bucket Files workspace accessible , collaborators (see details storage ). need move file workspace bucket personal workspace, use aou_bucket_to_workspace() move files bucket workspace want save something workspace bucket collaborators can use (can shut workspace save $$$), can use aou_workspace_to_bucket() move files workspace bucket permanent storage. also function can use load packages, install yet (longer) installed environment.","code":"library(allofus) con <- aou_connect() aou_ls_bucket() aou_bucket_to_workspace(\"file1.csv\") data <- read.csv(\"file1.csv\") write.csv(data, \"file1.csv\") aou_bucket_to_workspace(\"file1.csv\") bookstore(c(\"CohortGenerator\", \"tidyr\")"},{"path":"/index.html","id":"bugs","dir":"","previous_headings":"R package to streamline use of the AllofUs Research Workbench","what":"Bugs","title":"R package to streamline use of the AllofUs Resarcher Workbench ","text":"Please leave us comments, requests, report bugs using “Issues” tab github located : https://github.com/roux-ohdsi/allofus/issues.","code":""},{"path":"/index.html","id":"tips-on-using-the-allofus-workbench","dir":"","previous_headings":"R package to streamline use of the AllofUs Research Workbench","what":"Tips on using the AllofUs Workbench","title":"R package to streamline use of the AllofUs Resarcher Workbench ","text":"Working data AllofUs similar working OMOP CDM instances important differences: AllofUs includes data typical OMOP CDM tables, well additional AllofUs specific tables. data dictionary registered tier can found controlled tier . part, additional tables hold data collected AllofUs typical EHR claims data (e.g., fitbit data). can write temporary tables database AllofUs dplyr/dbplyr won’t write temporary tables bigquery db. Additionally, users permanent write access schema database. Unfortunately, means many OHDSI R packages work allofus workbench. also means can’t use SQL/JSON code generated ATLAS pull cohort (code also uses user schema/write schema). workbench uses jupyter notebooks (though RStudio coming). ’s important understand data stored AllofUs. user persistent disk (“workspace”) specific user. given Project Workspace, shared “data bucket” holds data anyone access Project workspace can access. Unless ’re sure one else need see data scripts use data, currently recommend using bucket storage needs permanent. However, unlike persistent disk, can’t just run read.csv(\"data.csv\") bucket. move data bucket persistent disk/workspace (current environment) first.","code":""},{"path":"/index.html","id":"example","dir":"","previous_headings":"R package to streamline use of the AllofUs Research Workbench","what":"Example","title":"R package to streamline use of the AllofUs Resarcher Workbench ","text":"following code start query first survey date AllofUs survey “Basics” (sometimes, rarely, participants completed survey multiple dates). ds_survey table conveniently organized, include “skip” response surveys, don’t recommend using unless ’re sure potential responses recorded table. ’s safest use observation table. can see detailed description survey ETL : https://support.researchallofus.org/hc/en-us/articles/6085114880148. code start us specific person table join survey dates table incorporate information demographics. leave query, pull data local session:","code":"library(tidyverse)  survey_dates = tbl(con, \"ds_survey\") %>%   filter(survey == \"The Basics\") %>%   group_by(person_id) %>%   filter(survey_datetime == min(survey_datetime)) %>%   distinct(person_id, survey_datetime) demo <- tbl(con, \"cb_search_person\") %>%   filter(age_at_consent >= 40 & age_at_consent <= 120,          has_ehr_data == 1) %>%   distinct(person_id, sex_at_birth, dob)  %>%   inner_join(survey_dates, by = \"person_id\") %>%   select(person_id, sex_at_birth, dob, survey_datetime) demo_collected <- demo %>% collect()"},{"path":"/reference/aou_bucket_to_workspace.html","id":null,"dir":"Reference","previous_headings":"","what":"Move files from a bucket to your workspace — aou_bucket_to_workspace","title":"Move files from a bucket to your workspace — aou_bucket_to_workspace","text":"step retrieves file saved permanently bucket workspace can read R using function like write.csv().","code":""},{"path":"/reference/aou_bucket_to_workspace.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Move files from a bucket to your workspace — aou_bucket_to_workspace","text":"","code":"aou_bucket_to_workspace(files, bucket_name = Sys.getenv(\"WORKSPACE_BUCKET\"))"},{"path":"/reference/aou_bucket_to_workspace.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Move files from a bucket to your workspace — aou_bucket_to_workspace","text":"files name file bucket vector multiple files. bucket_name Name bucket. Recommend leaving default","code":""},{"path":"/reference/aou_connect.html","id":null,"dir":"Reference","previous_headings":"","what":"Connect to big query database in All of Us — aou_connect","title":"Connect to big query database in All of Us — aou_connect","text":"use, simply run function without arguments. print message connect successfully. also assign bucket object R environment.","code":""},{"path":"/reference/aou_connect.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Connect to big query database in All of Us — aou_connect","text":"","code":"aou_connect(bucket_name = \"bucket\")"},{"path":"/reference/aou_connect.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Connect to big query database in All of Us — aou_connect","text":"bucket_name variable name bucket. Recommend leaving default.","code":""},{"path":"/reference/aou_ls_bucket.html","id":null,"dir":"Reference","previous_headings":"","what":"List the current files in your bucket. — aou_ls_bucket","title":"List the current files in your bucket. — aou_ls_bucket","text":"Quick function list files matching pattern bucket","code":""},{"path":"/reference/aou_ls_bucket.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"List the current files in your bucket. — aou_ls_bucket","text":"","code":"aou_ls_bucket(   pattern = \"\",   bucket_name = Sys.getenv(\"WORKSPACE_BUCKET\"),   silent = FALSE )"},{"path":"/reference/aou_ls_bucket.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"List the current files in your bucket. — aou_ls_bucket","text":"pattern pattern like *.csv single file name e.g., mydata.csv bucket_name name bucket. Recommend leaving default silent logical; whether print files found","code":""},{"path":"/reference/aou_ls_workspace.html","id":null,"dir":"Reference","previous_headings":"","what":"List the current files in your workspace. — aou_ls_workspace","title":"List the current files in your workspace. — aou_ls_workspace","text":"List current files workspace.","code":""},{"path":"/reference/aou_ls_workspace.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"List the current files in your workspace. — aou_ls_workspace","text":"","code":"aou_ls_workspace(pattern = \"\", silent = FALSE)"},{"path":"/reference/aou_ls_workspace.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"List the current files in your workspace. — aou_ls_workspace","text":"pattern pattern like *.csv single file name e.g., mydata.csv silent logical; whether print files found","code":""},{"path":"/reference/aou_pull_concepts.html","id":null,"dir":"Reference","previous_headings":"","what":"Get occurrences of a concepts from AoU for a given cohort — aou_pull_concepts","title":"Get occurrences of a concepts from AoU for a given cohort — aou_pull_concepts","text":"Get occurrences concepts AoU given cohort","code":""},{"path":"/reference/aou_pull_concepts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get occurrences of a concepts from AoU for a given cohort — aou_pull_concepts","text":"","code":"aou_pull_concepts(   cohort,   concepts,   start_date,   end_date,   concept_set_name = \"concepts\",   domains = c(\"condition\", \"measurement\", \"observation\", \"procedure\", \"drug\", \"device\"),   min_n = NULL,   n = FALSE,   keep_all = FALSE,   con = getOption(\"con.default.value\"),   collect = TRUE,   ... )"},{"path":"/reference/aou_pull_concepts.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get occurrences of a concepts from AoU for a given cohort — aou_pull_concepts","text":"cohort tbl; reference table column called \"person_id\", columns start_date end_date concepts num; vector concept ids start_date name start_date column cohort table (unquoted) end_date name end_date column cohort table (unquoted) concept_set_name chr; Name describe concept set, used create indicator variable min_n dbl; minimum number occurrences per person consider indicator true n dbl; count number occurrences per person (include zeros) keep_all lgl; keep columns information concept (e.g., concept name, id, etc.) con connection object AoU collect lgl; whether collect database","code":""},{"path":"/reference/aou_pull_concepts.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get occurrences of a concepts from AoU for a given cohort — aou_pull_concepts","text":"dataframe collect = TRUE; remote tbl ","code":""},{"path":"/reference/aou_pull_concepts.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get occurrences of a concepts from AoU for a given cohort — aou_pull_concepts","text":"","code":"if (FALSE) { # simple example tobacco <- pull_concepts(cohort, concepts = 1157, start_date = covariate_start_date,  end_date = cohort_start_date, name = \"tobacco\")  # starting with person table people <- tbl(con, \"cb_search_person\") %>% mutate(start_date = as.Date(\"1970-01-01\"),        end_date = as.Date(\"2023-05-24\"))  dat <- aou_pull_concepts(cohort = people,                          concepts = c(725115, 1612146, 1613031),                          start_date = start_date,                          end_date = end_date, concept_set_name = \"CGM\",                          domains = c(\"condition\", \"measurement\", \"observation\", \"procedure\", \"drug\", \"device\"),                          keep_all = TRUE)  }"},{"path":"/reference/aou_pull_survey_concepts.html","id":null,"dir":"Reference","previous_headings":"","what":"Get survey questions from AoU for a given cohort — aou_pull_survey_concepts","title":"Get survey questions from AoU for a given cohort — aou_pull_survey_concepts","text":"Get survey questions AoU given cohort","code":""},{"path":"/reference/aou_pull_survey_concepts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get survey questions from AoU for a given cohort — aou_pull_survey_concepts","text":"","code":"aou_pull_survey_concepts(   cohort,   concepts,   collect = TRUE,   reshape = FALSE,   ... )"},{"path":"/reference/aou_pull_survey_concepts.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get survey questions from AoU for a given cohort — aou_pull_survey_concepts","text":"cohort tbl; reference table column called \"person_id\" concepts num; vector concept ids questions survey table collect lgl; whether collect database reshape lgl; whether turn long data wide data clean variable names","code":""},{"path":"/reference/aou_pull_survey_concepts.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get survey questions from AoU for a given cohort — aou_pull_survey_concepts","text":"reshape = FALSE, dataframe remote tbl columns person_id, date (survey_datetime),  concept_id (question_concept_id), question, answer. reshape = TRUE, dataframe  questions columns. multiple answers per person (\"checkbox\" questions) list-columns.","code":""},{"path":[]},{"path":"/reference/aou_workspace_to_bucket.html","id":null,"dir":"Reference","previous_headings":"","what":"Save a file from your workspace to your bucket. — aou_workspace_to_bucket","title":"Save a file from your workspace to your bucket. — aou_workspace_to_bucket","text":"step permanently saves file saved workspace bucket can always retrieve . use, first need save desired r object file (e.g., write.csv(object, filename.csv)) run function (e.g., aou_workspace_to_bucket(files = \"filename.csv\")).","code":""},{"path":"/reference/aou_workspace_to_bucket.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Save a file from your workspace to your bucket. — aou_workspace_to_bucket","text":"","code":"aou_workspace_to_bucket(files, bucket_name = Sys.getenv(\"WORKSPACE_BUCKET\"))"},{"path":"/reference/aou_workspace_to_bucket.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Save a file from your workspace to your bucket. — aou_workspace_to_bucket","text":"files name file save bucket_name name bucket. Recommend leaving default","code":""},{"path":"/reference/bookstore.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to Install and Load R Packages — bookstore","title":"Function to Install and Load R Packages — bookstore","text":"Function Install Load R Packages","code":""},{"path":"/reference/bookstore.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to Install and Load R Packages — bookstore","text":"","code":"bookstore(package_names, quietly = TRUE)"},{"path":"/reference/bookstore.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to Install and Load R Packages — bookstore","text":"package_names character vector package names CRAN github description bookstore() function check see packages provided already installed local machine. installed, look package CRAN install found. find package CRAN, 'll ask owner/repository_name github install package github. input provided without quotes. example, respond roux-ohdsi/ohdsilab \"roux-ohdsi/ohdsilab\".","code":""},{"path":"/reference/bookstore.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Function to Install and Load R Packages — bookstore","text":"","code":"if (FALSE) { bookstore(c(\"aouFI\", \"CohortGenerator\", \"tidyr\")) }"},{"path":"/reference/omop_join.html","id":null,"dir":"Reference","previous_headings":"","what":"Join current query to another omop table — omop_join","title":"Join current query to another omop table — omop_join","text":"Simple wrapper join functions join existing query another table omop cdm (source).","code":""},{"path":"/reference/omop_join.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Join current query to another omop table — omop_join","text":"","code":"omop_join(   data,   table,   type,   by,   suffix = c(\"_x\", \"_y\"),   con = getOption(\"con.default.value\"),   x_as = NULL,   y_as = NULL,   ... )"},{"path":"/reference/omop_join.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Join current query to another omop table — omop_join","text":"data sql query dbplyr/dplyr. table omop table (table schema) wish join type type join. use types available dplyr: left, right, inner, anti, full etc. con defaults connection set options() x_as optional; string name left table y_as optional; string name right table ... arguments passed join function. e.g., = \"person_id\"","code":""},{"path":"/reference/omop_join.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Join current query to another omop table — omop_join","text":"Continued dplyr query","code":""},{"path":"/reference/omop_join.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Join current query to another omop table — omop_join","text":"Include following line top script setting connection con refers connection object R. options(con.default.value = con) good reasons use omop_join() possible x_join functions dplyr. First, reduces code necessary join existing table another table. Second, includes checks/workarounds two sources common errors using dplyr DatabaseConnector: automatically appends x_as y_as arguments join call provided changes default suffix .x/.y _x/_y cases shared column names specified argument result sql error.","code":""},{"path":"/reference/omop_join.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Join current query to another omop table — omop_join","text":"","code":"allofus::aou_connect() #> Error: Unable to connect #> <BigQueryConnection> #>   Dataset: NA.NA #>   Billing:  options(con.default.value = con) #> Error in options(con.default.value = con): object 'con' not found obs_tbl |>   omop_join(\"person\", type = \"left\", by = \"person_id\") #> Error in tbl(con, table): could not find function \"tbl\""}]
