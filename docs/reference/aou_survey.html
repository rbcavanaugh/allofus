<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='Extracts survey responses in a tidy format that also includes
‘skip’ responses and collapses across all versions of the person health /
personal medical history surveys. Currently responses in the ‘ds_survey’
table omit skipped responses. Responses are returned as Yes" if the
respondent answered that the individual had the condition, No" if the
respondent answered that the individual did not have that condition (or
omitted it when selecting from related conditions), a skip response if the
question was skipped, and NA if the respondent did not answer the question.
Returns a data frame or SQL tbl with the initial cohort table along with a
column for each question included in questions and answers foreach
person_id in the cells. To find the desired survey questions, use the all
of us data dictionary, survey codebook, Athena, data browser, or the
modified codebook which can be found in the allofus R package.'><title>Function to query allofus observation table for survey responses — aou_survey • allofus</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Function to query allofus observation table for survey responses — aou_survey"><meta property="og:description" content='Extracts survey responses in a tidy format that also includes
‘skip’ responses and collapses across all versions of the person health /
personal medical history surveys. Currently responses in the ‘ds_survey’
table omit skipped responses. Responses are returned as Yes" if the
respondent answered that the individual had the condition, No" if the
respondent answered that the individual did not have that condition (or
omitted it when selecting from related conditions), a skip response if the
question was skipped, and NA if the respondent did not answer the question.
Returns a data frame or SQL tbl with the initial cohort table along with a
column for each question included in questions and answers foreach
person_id in the cells. To find the desired survey questions, use the all
of us data dictionary, survey codebook, Athena, data browser, or the
modified codebook which can be found in the allofus R package.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-black"><div class="container">
    <div style="height:40px;display:inline;margin:0 10px;"><a href="https://ohdsi.northeastern.edu/" class="external-link"><img src="https://roux-ohdsi.github.io/allofus/articles/logo.png" style="width:auto;height:100%;"></a></div>
    <a class="navbar-brand me-2" href="../index.html">allofus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/allofus.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/workspace.html">Managing files on the workbench</a>
    <a class="dropdown-item" href="../articles/data.html">Extracting All of Us survey and EHR data</a>
    <a class="dropdown-item" href="../articles/atlas.html">Using ATLAS to create a cohort</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Codebooks</h6>
    <a class="dropdown-item" href="../articles/web_only/searchable_codebook.html">All of Us Surveys</a>
    <a class="dropdown-item" href="../articles/web_only/health_codebook.html">Health History Surveys</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/roux-ohdsi/allofus/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Function to query allofus observation table for survey responses</h1>
      <small class="dont-index">Source: <a href="https://github.com/roux-ohdsi/allofus/blob/HEAD/R/aou_survey.R" class="external-link"><code>R/aou_survey.R</code></a></small>
      <div class="d-none name"><code>aou_survey.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Extracts survey responses in a tidy format that also includes
‘skip’ responses and collapses across all versions of the person health /
personal medical history surveys. Currently responses in the ‘ds_survey’
table omit skipped responses. Responses are returned as Yes" if the
respondent answered that the individual had the condition, No" if the
respondent answered that the individual did not have that condition (or
omitted it when selecting from related conditions), a skip response if the
question was skipped, and NA if the respondent did not answer the question.
Returns a data frame or SQL tbl with the initial cohort table along with a
column for each question included in questions and answers foreach
person_id in the cells. To find the desired survey questions, use the all
of us data dictionary, survey codebook, Athena, data browser, or the
modified codebook which can be found in the allofus R package.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">aou_survey</span><span class="op">(</span></span>
<span>  cohort <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">questions</span>,</span>
<span>  question_output <span class="op">=</span> <span class="st">"concept_code"</span>,</span>
<span>  clean_answers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  collect <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  con <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"aou.default.con"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>cohort</dt>
<dd><p>Reference to a remote table or local dataframe with a column
called "person_id"</p></dd>


<dt>questions</dt>
<dd><p>either a vector of concept_ids or concept_codes for
questions to return results</p></dd>


<dt>question_output</dt>
<dd><p>how to name the columns. Options include as the text
of the concept code ("concept_code"), as concept ids preceded by "x_"
("concept_id"), or using a custom vector of column names matching the
vector of <code>questions</code>. Defaults to "concept_code".</p></dd>


<dt>clean_answers</dt>
<dd><p>whether to clean the answers to the survey questions.
Defaults to TRUE.</p></dd>


<dt>collect</dt>
<dd><p>Whether to bring the resulting table into local memory
(<code>collect = TRUE</code>) as a dataframe or leave as a reference to a database
table (for continued analysis using, e.g., <code>dbplyr</code>). Defaults to <code>FALSE.</code></p></dd>


<dt>...</dt>
<dd><p>additional arguments passed to <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> when <code>collect = TRUE</code></p></dd>


<dt>con</dt>
<dd><p>connection to the allofus SQL database. Defaults to
getOption("aou.default.con"), which is created automatically with
<code><a href="aou_connect.html">aou_connect()</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A dataframe if <code>collect = TRUE</code>; a reference to a remote database
table if not.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function will return a dataframe or SQL tbl with the initial
cohort table along with a column for each question included in <code>questions</code>
and answers for each person_id in the cells. The column names (questions)
can be returned as the concept_code or concept_id or by providing new
column names. For each question, a column with the suffix "_date" is
included with the date on which the question was answered. When questions
can have multiple answers ("checkbox"-style questions), answers are
returned as a comma-separated string.</p>
<p>To find the desired survey questions, use the all of us data dictionary,
survey codebook, athena, data browser, or the allofus R package modified
codebook which can be found here:
https://roux-ohdsi.github.io/allofus/articles/searchable_codebook.html For
questions regarding an individual's health history or family health
history, the function requires the specific concept_id (or concept_code)
for individual in question, whether that is "self" or another relative.
Responses are returned as "Yes" if the respondent answered that the
individual had the condition, "No" if the respondent answered that the
individual did not have that condition (or omitted it when selecting from
related conditions), a skip response if the question was skipped, and NA if
the respondent did not answer the question.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># on_workbench()</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="aou_connect.html">aou_connect</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"person"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">person_id</span> <span class="op">&gt;</span> <span class="fl">5000000</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">person_id</span>, <span class="va">year_of_birth</span>, <span class="va">gender_concept_id</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">aou_survey</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">cohort</span>,</span></span>
<span class="r-in"><span>  questions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1585375</span>, <span class="fl">1586135</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  question_output <span class="op">=</span> <span class="st">"concept_code"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">aou_survey</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">cohort</span>,</span></span>
<span class="r-in"><span>  questions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1585811</span>, <span class="fl">1585386</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  question_output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pregnancy"</span>, <span class="st">"insurance"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">aou_survey</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">cohort</span>,</span></span>
<span class="r-in"><span>  questions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1585375</span>, <span class="fl">1586135</span>, <span class="fl">1740719</span>, <span class="fl">43529932</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  question_output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income"</span>, <span class="st">"birthplace"</span>, <span class="st">"grandpa_bowel_obstruction"</span>, <span class="st">"t2dm"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  collect <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">aou_survey</span><span class="op">(</span><span class="va">cohort</span>,</span></span>
<span class="r-in"><span>  questions <span class="op">=</span> <span class="fl">1384452</span>,</span></span>
<span class="r-in"><span>  question_output <span class="op">=</span> <span class="st">"osteoarthritis"</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">osteoarthritis</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Louisa Smith, Rob Cavanaugh.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

