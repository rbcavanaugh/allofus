<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function retrieves a cohort definition from ATLAS and generates the cohort in All of Us.
Observation periods are first generated for each subject using the aou_observation_period() function.
The resulting cohort is a dataframe with the cohort start and end dates for each subject.
The function is based on a similar function in https://github.com/cmayer2/r4aou with some tweaks
to generate the appropriate observation periods and incorporate other package functions.
Please see the online vignette for additional details insert link here"><title>Retrieve a cohort from ATLAS for use in All of Us — aou_atlas_cohort • allofus</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Retrieve a cohort from ATLAS for use in All of Us — aou_atlas_cohort"><meta property="og:description" content="This function retrieves a cohort definition from ATLAS and generates the cohort in All of Us.
Observation periods are first generated for each subject using the aou_observation_period() function.
The resulting cohort is a dataframe with the cohort start and end dates for each subject.
The function is based on a similar function in https://github.com/cmayer2/r4aou with some tweaks
to generate the appropriate observation periods and incorporate other package functions.
Please see the online vignette for additional details insert link here"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-black"><div class="container">
    <div style="height:40px;display:inline;margin:0 10px;"><a href="https://ohdsi.northeastern.edu/" class="external-link"><img src="https://roux-ohdsi.github.io/allofus/articles/logo.png" style="width:auto;height:100%;"></a></div>
    <a class="navbar-brand me-2" href="../index.html">allofus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/allofus.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/workspace.html">Managing files on the workbench</a>
    <a class="dropdown-item" href="../articles/data.html">Extracting All of Us survey and EHR data</a>
    <a class="dropdown-item" href="../articles/atlas.html">Using ATLAS to create a cohort</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Codebooks</h6>
    <a class="dropdown-item" href="../articles/web_only/searchable_codebook.html">All of Us Surveys</a>
    <a class="dropdown-item" href="../articles/web_only/health_codebook.html">Health History Surveys</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/roux-ohdsi/allofus/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Retrieve a cohort from ATLAS for use in All of Us</h1>
      <small class="dont-index">Source: <a href="https://github.com/roux-ohdsi/allofus/blob/HEAD/R/aou_atlas_cohort.R" class="external-link"><code>R/aou_atlas_cohort.R</code></a></small>
      <div class="d-none name"><code>aou_atlas_cohort.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function retrieves a cohort definition from ATLAS and generates the cohort in All of Us.
Observation periods are first generated for each subject using the <code><a href="aou_observation_period.html">aou_observation_period()</a></code> function.
The resulting cohort is a dataframe with the cohort start and end dates for each subject.
The function is based on a similar function in <a href="https://github.com/cmayer2/r4aou" class="external-link">https://github.com/cmayer2/r4aou</a> with some tweaks
to generate the appropriate observation periods and incorporate other package functions.
Please see the online vignette for additional details insert link here</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">aou_atlas_cohort</span><span class="op">(</span><span class="va">cohort_definition</span>, <span class="va">cohort_sql</span>, debug <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>cohort_definition</dt>
<dd><p>A cohort definition generated using <code>getCohortDefinition() from ROhdsiWebApi</code></p></dd>


<dt>cohort_sql</dt>
<dd><p>The cohort_sql generated using <code>getCohortSql() from ROhdsiWebApi</code></p></dd>


<dt>debug</dt>
<dd><p>Print the query to the console; useful for debugging.</p></dd>


<dt>...</dt>
<dd><p>Further arguments passed along to <code>collect()</code> if <code>collect = TRUE</code></p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A dataframe with the resulting cohort. The SQL query used to generate the cohort is stored as an attribute.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The current observation period table in the All of Us OMOP CDM is not always
appropriate for cohorts generated using OHDSI tools such as ATLAS. Some observation
periods are overly short and some participants have hundreds of observation periods.</p>
<p>This function generates an observation period table from the first occurrence of
a clinical event in the EHR tables to the last clinical event in the EHR tables.
It will only return a single observation period per person_id in the database. If
<code>collect = FALSE</code>, the function returns a query to a temporary table in the database
which can be referenced by typical dplyr functions.</p>
<p>Normal OMOP conventions for EHR suggest that long lapses of time bewteen clinical
events may indicate that the person was not "observed" during this period. However,
due to the diverse nature of clinical EHR data contributed to all of us, it seems
most conservative to assume that the person was observed from their first to last
clinical event. See https://ohdsi.github.io/CommonDataModel/ehrObsPeriods.html
for more details.</p>
<p>Some users have clinical events going back to before the time of widespread
electronic medical record use (e.g., the 1980s and 1990s). This function considers
all EHR data in the database, regardless of the date of the clinical event, but we
recommend that users consider the implications of including data from the 1980s and 1990s.
It may be more prudent to exclude data prior to a more recent cutoff date so that the EHR
data is more likely to be accurate, though this decision depends highly on the research
question (see example below).</p>
<p>Users should note that the aou_observation_period function will only generate observation periods for
participants who have at least one clinical observation. If participant in the AllofUs research
program who did not include electronic health record data are included in the cohort argument, or
elected to contribute data but have no data to contribute, they will not be included in the
generated observation period table.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># on_workbench()</span></span></span>
<span class="r-in"><span><span class="co"># generate a simple stroke cohort</span></span></span>
<span class="r-in"><span><span class="co"># see https://atlas-demo.ohdsi.org/#/cohortdefinition/1788061</span></span></span>
<span class="r-in"><span><span class="co"># aou_cohort_example contains the results of</span></span></span>
<span class="r-in"><span><span class="co"># cd &lt;- ROhdsiWebApi::getCohortDefinition(1788061, "https://atlas-demo.ohdsi.org/WebAPI")</span></span></span>
<span class="r-in"><span><span class="co"># cd_sql &lt;- ROhdsiWebApi::getCohortSql(cd, "https://atlas-demo.ohdsi.org/WebAPI")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="fu">aou_atlas_cohort</span><span class="op">(</span></span></span>
<span class="r-in"><span>  cohort_definition <span class="op">=</span> <span class="va">aou_cohort_example</span><span class="op">$</span><span class="va">cd</span>,</span></span>
<span class="r-in"><span>  cohort_sql <span class="op">=</span> <span class="va">aou_cohort_example</span><span class="op">$</span><span class="va">cd_sql</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># print query that was executed</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">cohort</span>, <span class="st">"query"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Louisa Smith, Rob Cavanaugh.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

